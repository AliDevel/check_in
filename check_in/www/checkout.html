
<head>
    
    <script src="assets/js/scanner.js"></script>   

</head>


    <div class="card-container">
        <img id="image" class="round" src="https://randomuser.me/api/portraits/women/79.jpg" alt="user" />
        <h3>Welcome </h1>
        <h3 id="name">Employee Name</h3>
        <h6>ERP Caspy</h6>
         <p id="check">Please use RFID tag to Check-in</p>
         
       
        <div class="checktime">
            <p id="last"></p>
            <p id="now">Date: 09 Oct 2022, 16:44:23</p> 
        </div>
    </div>

    <script>
      const date = new Date();

      let day = date.getDate();
      let month = date.getMonth() + 1;
      let year = date.getFullYear();
      
      // This arrangement can be altered based on how we want the date's format to appear.
      let currentDate = `${day}-${month}-${year}`;
      document.getElementById("now").innerText= "Today is:"+currentDate;
        onscan.attachTo(document, {
            onScan: function (sScancode) {
                console.log(sScancode)
            frappe.call({
                    method: "check_in.api.get_status",
                    args: {
                        attendance_id: sScancode
                    },
                    callback: function(r) {
                      if (r.message=="OUT") {
                         console.log('SOUT');
                         check_in(sScancode);		
                      } 
                      if (r.message=="IN")  {
                        console.log('SIN');
                        check_out(sScancode);
                      }
                    }
                  });
                
            }
        });
    
        var paragraph = document.getElementById("p1")
        function check_in(attendance_id) {
              frappe.call({
                method: "check_in.api.check_in",
               args: {
                    attendance_id: attendance_id
                },
                callback: function(r) {
                  if (r.message) {
            
                    console.log(r.message)
                    populate(r.message)
                  }
                }
              });}
            function populate(message){
               
                document.getElementById('name').innerText=message[0]
                document.getElementById("image").src='http://site.localhost:8000'+message[1]
                if(message[2]==='IN'){
                document.getElementById('last').innerText='Last Check in ' + message[3]
                document.getElementById('check').innerText="Check In"
                }
              else {
                document.getElementById('last').innerText='Last Check out ' + message[3]
                document.getElementById('check').innerText="Check out"
              }
            }
              function check_out(attendance_id) {
                frappe.call({
                  method: "erpnext.hr.api.check_out",
                  args: {
                    attendance_id: attendance_id
                },
                  callback: function(r) {
                    if (r.message) {
                 
                      console.log(r.message)
                      populate(r.message)
                    }
                  }
                });}
                
    </script>